<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ Valerie</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
            border-bottom: 2px solid #df3036;
            padding-bottom: 10px;
        }
        .test-result {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        button {
            background: #df3036;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #c02a2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –¢–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ Valerie</h1>
        <p>–≠—Ç–æ—Ç —Ñ–∞–π–ª –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –Ω–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º.</p>
        
        <div id="test-results"></div>
        
        <h2>üß™ –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π</h2>
        <button onclick="runAllTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
        <button onclick="testOldConstants()">–¢–µ—Å—Ç —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç</button>
        <button onclick="testNewFunctions()">–¢–µ—Å—Ç –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π</button>
        <button onclick="testDataStructures()">–¢–µ—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö</button>
        
        <div id="detailed-results"></div>
    </div>

    <script src="constants.js"></script>
    <script>
        let testResults = [];
        
        function addTestResult(name, status, message, details = null) {
            testResults.push({ name, status, message, details });
        }
        
        function runAllTests() {
            testResults = [];
            
            // –¢–µ—Å—Ç 1: –°—Ç–∞—Ä—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
            testOldConstants();
            
            // –¢–µ—Å—Ç 2: –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            testNewFunctions();
            
            // –¢–µ—Å—Ç 3: –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
            testDataStructures();
            
            // –¢–µ—Å—Ç 4: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
            testCompatibility();
            
            displayResults();
        }
        
        function testOldConstants() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω—ã
                if (typeof PARTICIPANT_PARAMETERS !== 'undefined') {
                    addTestResult(
                        'PARTICIPANT_PARAMETERS',
                        'success',
                        `‚úÖ –ú–∞—Å—Å–∏–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç ${PARTICIPANT_PARAMETERS.length} –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤`,
                        PARTICIPANT_PARAMETERS.map(p => `${p.label} (${p.field})`).join(', ')
                    );
                } else {
                    addTestResult('PARTICIPANT_PARAMETERS', 'error', '‚ùå –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                if (typeof CHECKBOX_LABELS !== 'undefined') {
                    addTestResult(
                        'CHECKBOX_LABELS',
                        'success',
                        `‚úÖ –ú–∞—Å—Å–∏–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç ${CHECKBOX_LABELS.length} –ª–µ–π–±–ª–æ–≤`,
                        CHECKBOX_LABELS.join(', ')
                    );
                } else {
                    addTestResult('CHECKBOX_LABELS', 'error', '‚ùå –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                if (typeof CHECKBOX_COLUMNS !== 'undefined') {
                    addTestResult(
                        'CHECKBOX_COLUMNS',
                        'success',
                        `‚úÖ –ú–∞—Å—Å–∏–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç ${CHECKBOX_COLUMNS.length} —Å—Ç–æ–ª–±—Ü–æ–≤`,
                        CHECKBOX_COLUMNS.join(', ')
                    );
                } else {
                    addTestResult('CHECKBOX_COLUMNS', 'error', '‚ùå –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
            } catch (error) {
                addTestResult('–°—Ç–∞—Ä—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã', 'error', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        function testNewFunctions() {
            try {
                // –¢–µ—Å—Ç getActiveSpecialPrizes
                const activePrizes = getActiveSpecialPrizes();
                addTestResult(
                    'getActiveSpecialPrizes()',
                    'success',
                    `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${activePrizes.length} –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–µ—Ü–ø—Ä–∏–∑–æ–≤`,
                    activePrizes.map(p => `${p.label} (${p.field})`).join(', ')
                );
                
                // –¢–µ—Å—Ç getRequiredParameters
                const requiredParams = getRequiredParameters();
                addTestResult(
                    'getRequiredParameters()',
                    'success',
                    `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${requiredParams.length} –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤`,
                    requiredParams.map(p => `${p.label} (${p.field})`).join(', ')
                );
                
                // –¢–µ—Å—Ç getAllUsedColumns
                const allColumns = getAllUsedColumns();
                addTestResult(
                    'getAllUsedColumns()',
                    'success',
                    `‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ${allColumns.length} —Å—Ç–æ–ª–±—Ü–æ–≤`,
                    allColumns.join(', ')
                );
                
                // –¢–µ—Å—Ç validateSettings
                const validation = validateSettings();
                if (validation.isValid) {
                    addTestResult('validateSettings()', 'success', '‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–Ω—ã');
                } else {
                    addTestResult('validateSettings()', 'error', `‚ùå –û—à–∏–±–∫–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö: ${validation.errors.join(', ')}`);
                }
                
                // –¢–µ—Å—Ç getSettingsStats
                const stats = getSettingsStats();
                addTestResult(
                    'getSettingsStats()',
                    'success',
                    `‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞: ${stats.totalParameters} –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, ${stats.activeSpecialPrizes} —Å–ø–µ—Ü–ø—Ä–∏–∑–æ–≤`,
                    JSON.stringify(stats, null, 2)
                );
                
            } catch (error) {
                addTestResult('–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏', 'error', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        function testDataStructures() {
            try {
                // –¢–µ—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                const param = PARTICIPANT_PARAMETERS[0];
                const requiredFields = ['label', 'column', 'options', 'field'];
                const hasAllFields = requiredFields.every(field => param.hasOwnProperty(field));
                
                if (hasAllFields) {
                    addTestResult(
                        '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤',
                        'success',
                        '‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç',
                        `–ü—Ä–∏–º–µ—Ä: ${param.label} - –ø–æ–ª–µ: ${param.field}, —Å—Ç–æ–ª–±–µ—Ü: ${param.column}, –±–∞–ª–ª—ã: ${param.options}`
                    );
                } else {
                    addTestResult('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤', 'error', '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è');
                }
                
                // –¢–µ—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–ø–µ—Ü–ø—Ä–∏–∑–æ–≤
                const activePrizes = getActiveSpecialPrizes();
                if (activePrizes.length > 0) {
                    const prize = activePrizes[0];
                    const requiredPrizeFields = ['label', 'column', 'field', 'active', 'value'];
                    const hasAllPrizeFields = requiredPrizeFields.every(field => prize.hasOwnProperty(field));
                    
                    if (hasAllPrizeFields) {
                        addTestResult(
                            '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ø–µ—Ü–ø—Ä–∏–∑–æ–≤',
                            'success',
                            '‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç',
                            `–ü—Ä–∏–º–µ—Ä: ${prize.label} - –ø–æ–ª–µ: ${prize.field}, —Å—Ç–æ–ª–±–µ—Ü: ${prize.column}, –∞–∫—Ç–∏–≤–µ–Ω: ${prize.active}`
                        );
                    } else {
                        addTestResult('–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ø–µ—Ü–ø—Ä–∏–∑–æ–≤', 'error', '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è');
                    }
                }
                
            } catch (error) {
                addTestResult('–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö', 'error', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        function testCompatibility() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å–æ —Å—Ç–∞—Ä—ã–º–∏
                const oldLabels = CHECKBOX_LABELS;
                const newLabels = getActiveSpecialPrizes().map(p => p.label);
                
                if (oldLabels.length === newLabels.length) {
                    addTestResult(
                        '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ª–µ–π–±–ª–æ–≤',
                        'success',
                        '‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–µ–π–±–ª–æ–≤ —Å–æ–≤–ø–∞–¥–∞–µ—Ç',
                        `–°—Ç–∞—Ä—ã–µ: ${oldLabels.join(', ')}, –ù–æ–≤—ã–µ: ${newLabels.join(', ')}`
                    );
                } else {
                    addTestResult(
                        '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ª–µ–π–±–ª–æ–≤',
                        'warning',
                        `‚ö†Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–µ–π–±–ª–æ–≤ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å: –±—ã–ª–æ ${oldLabels.length}, —Å—Ç–∞–ª–æ ${newLabels.length}`
                    );
                }
                
                const oldColumns = CHECKBOX_COLUMNS;
                const newColumns = getActiveSpecialPrizes().map(p => p.column);
                
                if (oldColumns.length === newColumns.length) {
                    addTestResult(
                        '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å—Ç–æ–ª–±—Ü–æ–≤',
                        'success',
                        '‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤ —Å–æ–≤–ø–∞–¥–∞–µ—Ç',
                        `–°—Ç–∞—Ä—ã–µ: ${oldColumns.join(', ')}, –ù–æ–≤—ã–µ: ${newColumns.join(', ')}`
                    );
                } else {
                    addTestResult(
                        '–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å—Ç–æ–ª–±—Ü–æ–≤',
                        'warning',
                        `‚ö†Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å: –±—ã–ª–æ ${oldColumns.length}, —Å—Ç–∞–ª–æ ${newColumns.length}`
                    );
                }
                
            } catch (error) {
                addTestResult('–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å', 'error', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            const detailedDiv = document.getElementById('detailed-results');
            
            const successCount = testResults.filter(r => r.status === 'success').length;
            const warningCount = testResults.filter(r => r.status === 'warning').length;
            const errorCount = testResults.filter(r => r.status === 'error').length;
            
            resultsDiv.innerHTML = `
                <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <div class="test-result ${errorCount === 0 ? 'success' : 'error'}">
                    <strong>–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:</strong> ${testResults.length} | 
                    <strong>–£—Å–ø–µ—à–Ω–æ:</strong> ${successCount} | 
                    <strong>–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:</strong> ${warningCount} | 
                    <strong>–û—à–∏–±–∫–∏:</strong> ${errorCount}
                </div>
            `;
            
            detailedDiv.innerHTML = testResults.map(result => `
                <div class="test-result ${result.status}">
                    <strong>${result.name}:</strong> ${result.message}
                    ${result.details ? `
                        <div class="code-block" style="margin-top: 10px; font-size: 12px;">
                            ${result.details}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runAllTests, 100);
        });
    </script>
</body>
</html>
